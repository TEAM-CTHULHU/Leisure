<html>
<!--
Copyright (C) 2011, Bill Burdick, Tiny Concepts: http://tinyconcepts.com/fs.pl/lambda.fsl

(licensed with ZLIB license)

This software is provided 'as-is', without any express or implied
warranty. In no event will the authors be held liable for any damages
arising from the use of this software.

Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely, subject to the following restrictions:

1. The origin of this software must not be misrepresented; you must not
claim that you wrote the original software. If you use this software
in a product, an acknowledgment in the product documentation would be
appreciated but is not required.

2. Altered source versions must be plainly marked as such, and must not be
misrepresented as being the original software.

3. This notice may not be removed or altered from any source distribution.
-->
<head>
	<style>
		#grid td {
			position: relative;
			width: 24px;
			height: 24px;
		}
		#grid div {
			position: absolute;
			text-align: center;
			vertical-align: middle;
			width: 100%;
			height: 100%;
			outline: solid black 1px;
			overflow: clipped;
		}
		.hidden {
			height: 0;
			width: 0;
			visibility: hidden;
			display: none;
		}
	</style>
	<script src="lc.js"></script>
	<script>
var grid
var icons = ' sV^*'
var state

function icon(c) {
	return icons[num(c, 0, 1, 2, 3, 4)]
}

function updateGrid(rows) {
	for (var r = 0; r < 9; r++) {
		var row = rows(LC.code.get1)

		for (var c = 0; c < 9; c++) {
			grid.rows[r].cells[c].firstElementChild.innerHTML = icon(row(LC.code.get1))
			row = row(LC.code.left)
		}
		rows = rows(LC.code.left)
	}
}
function updateShip(row) {
	for (var i = 0; i < 9; i++) {
		grid.rows[9].cells[i].firstElementChild.innerHTML = icon(row(LC.code.get1))
		row = row(LC.code.left)
	}
}
var buttonCounter = 0
var buttonOp = null
var continueButton = false
function setOperation(op) {
	var old = buttonOp

	continueButton = true
	buttonOp = op
	if (!old) doOp()
}
function next() {
	window.setTimeout(function(){
		if (buttonOp) doOp()
	}, 200)
}
function doOp() {
	if (buttonCounter % 2 == 0) {
		buttonOp()
		if (!continueButton) buttonOp = stay
	} else {
		stay()
	}
	buttonCounter++
}
function left() {
	state = state(LC.code.moveLeft)
	display()
	next()
}
function stay() {
	state = state(LC.code.stay)
	display()
	next()
}
function right() {
	state = state(LC.code.moveRight)
	display()
	next()
}
function fire() {
	state = state(LC.code.fire)
	display()
	next()
}
function display() {
	updateGrid(state(LC.code['first']))
	updateShip(state(LC.code['second']))
}
function loaded() {
	wrap = LC.wrap
	output = document.getElementById('output')
	grid = document.getElementById('grid')
	LC.loadDefs(document.getElementById("code").innerHTML)
	state = LC.code.start()
	num = LC.lcode('num')
	display()
}
	</script>
</head>
<body onload="loaded()">
<table id="grid">
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
<tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
</table>
<br>
<button onmousedown='setOperation(left)' onmouseup='continueButton = false'>&lt;</button><button onmousedown='setOperation(fire)' onmouseup='continueButton = false'>*</button><button onmousedown='setOperation(right)' onmouseup='continueButton = false'>&gt;</button>
<div id='output'></div>
<pre class="hidden" id='code'>
# Booleans
true = \x y . x
t = true
false = \x y . y
f = false
not = \a . a false true

# Y combinator
Y = \g  .  (\x  .  g (x x)) \x  .  g (x x)
rec = \f . f (Y f)

# lists
# using false as "nil" in lists, so you use a list like this:
# DUMMY can be anything, but it needs to be there
# here's how you use a list:
# aList (\h t DUMMY . {list-case}) {empty-case}
# If the list is not empty, h and t are the head and tail of the list and it returns list-case.  DUMMY is not used, but needs to be there
# If the list is empty, it returns empty-case
cons = \a b f.f a b
nil = false
head = \l . l (\h t D . h) nil
tail = \l . l (\h t D . t) nil
null = \l . l (\h t D . false) true
last = rec \last l  . l (\h t D . null t h (last t)) nil
append = rec \append l1 l2 . l1 (\h t D . cons h (append t l2)) l2
reverse = \l . (rec \rev l res . l (\h t D . rev t (cons h res)) res) l nil
# list constructor: [1,2,3]
# this uses some parsing rules: =(]=, =.=, and =)=
[ =(]= \item f  .  f (cons item nil)
, =.= \l item f . f (cons item l)
] =)= reverse

# 10 x 9 grid (a 9x9 grid for missiles and aliens and a 9x1 row for the ship)
# a grid row applies a function of 9 arguments to its values
# a grid cell represents a value from 0 to 4 (empty, ship, alien1, alien2, missile)
#   higher values 'beat' lower values
#   cells are functions of 5 arguments and they indicate their value by returning the nth argument (like booleans)

# cell functions
e     = \1 2 3 4 5 . 1
s     = \1 2 3 4 5 . 2
a1    = \1 2 3 4 5 . 3
a2    = \1 2 3 4 5 . 4
m     = \1 2 3 4 5 . 5
num   = \n 0 1 2 3 4 . n 0 1 2 3 4
cellId = \n . n identity
cell  = \n f . f n
isE   = \n . n true false false false false
cmp   = \n1 n2 . n1 n2 (n2 n1 n1 n2 n2 n2) (n2 n1 n1 n1 n2 n2) (n2 n1 n1 n1 n1 n2) n1

# row functions
row   = \1 2 3 4 5 6 7 8 9 g . g 1 2 3 4 5 6 7 8 9
left  = \1 2 3 4 5 6 7 8 9 g . g 2 3 4 5 6 7 8 9 1
right = \1 2 3 4 5 6 7 8 9 g . g 9 1 2 3 4 5 6 7 8
cell1  = \1 2 3 4 5 6 7 8 9 . cell 1
cell9  = \1 2 3 4 5 6 7 8 9 . cell 9
get1  = \1 2 3 4 5 6 7 8 9 . 1
empty     = row e e e e e e e e e
arow1     = row e e a1 e a2 e a1 e e
arow2     = row e e a2 e a1 e a2 e e
gridStart = row arow1 arow2 arow1 arow2 empty empty empty empty empty
shipStart = row e e e e s e e e e

# grid functions
identity  = \x . x
ignore    = \x . row
onFirstEmpty    = \1 2 3 4 5 6 7 8 9 . 1 identity ignore ignore ignore ignore
# compare a cell with the first row element.  If they're both e, return e otherwise return one of the nonE values
check1    = \n r . r \m1 m2 m3 m4 m5 m6 m7 m8 m9 . cell (n m1 n n n n)
check9    = \n r . r \m1 m2 m3 m4 m5 m6 m7 m8 m9 . cell (n m9 n n n n)
isAllFirstEmpty = \1 2 3 4 5 6 7 8 9 . 1 cell1 check1 2 check1 3 check1 4 check1 5 check1 6 check1 7 check1 8 check1 9 isE
isAllLastEmpty  = \1 2 3 4 5 6 7 8 9 . 1 cell9 check9 2 check9 3 check9 4 check9 5 check9 6 check9 7 check9 8 check9 9 isE
allLeft   = \1 2 3 4 5 6 7 8 9 . row (1 left) (2 left) (3 left) (4 left) (5 left) (6 left) (7 left) (8 left) (9 left)
allRight  = \1 2 3 4 5 6 7 8 9 . row (1 right) (2 right) (3 right) (4 right) (5 right) (6 right) (7 right) (8 right) (9 right)

# counter
counter = \1 2 3 4 5 6 7 8 9 10 11 12 c . c 1 2 3 4 5 6 7 8 9 10 11 12
cNext   = \1 2 3 4 5 6 7 8 9 10 11 12 c . c 2 3 4 5 6 7 8 9 10 11 12 1
cTrue   = \1 2 3 4 5 6 7 8 9 10 11 12 . 1
slowest = counter t f f f f f f f f f f f
slower  = counter t f f f f f t f f f f f
slow    = counter t f f f t f f f t f f f
fast    = counter t f f t f f t f f t f f
faster  = counter t f t f t f t f t f t f
fastest = counter t t t t t t t t t t t t


# game functions
start     = \statef . statef gridStart shipStart true slow
checkDir  = \grid left? . left? (grid isAllFirstEmpty) (not (grid isAllLastEmpty))
next      = \grid ship left? counter statef . (\dir . statef (counter cTrue (grid (dir allLeft allRight)) grid) ship dir (counter cNext)) (checkDir grid left?)

# in progress
# moveThem = (\moveLeft moveRight . pair moveLeft moveRight) rec \moveThem 

#events
moveLeft  = \grid ship left? counter . next grid (ship (ship onFirstEmpty left)) left? counter
moveRight = \grid ship left? counter . next grid (ship (ship right onFirstEmpty right)) left? counter
stay      = \grid ship left? counter . next grid ship left? counter
fire      = \grid ship left? counter . next (missile grid ship) ship left? counter

# accessors
first = \a b c d . a
second = \a b c d . b
</pre>
</body>
</html>
