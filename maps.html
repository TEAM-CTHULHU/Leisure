<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <script src="leisure.js"></script>
    <script src="prim.js"></script>
    <script src="pretty.js"></script>
    <script src="replCore.js"></script>
    <script src="browserRepl.js"></script>
    <script src="std.js"></script>
    <script src="notebook.js"></script>
    <script src="jquery-1.7.2.min.js"></script>
<!--
    <script src="ace/src/ace-uncompressed-noconflict.js" type="text/javascript" charset="utf-8"></script>
-->
    <script src="maps.js"></script>
    <script src="svg.js"></script>

    <script>//<[!CDATA[
      function init() {
/*
        var input = document.getElementById('input')
        var output = document.getElementById('output')
        var defs = document.getElementById('defs')
*/
        var doc = document.getElementById('doc')

        try {
          $.ajax({
            url: 'std.lsr',
            success: function(data){stdDefs = data},
            error: function(){changeStdLinks()}
          });
        } catch (err) {
          changeStdLinks()
        }
        //Repl.init(input, output, defs);
        Repl.init()
        //clearOutput();
	Notebook.bindNotebook(document.getElementById('editor'));
	evalDoc()
      }
      function changeStdLinks() {
        changeStdLink('stdDefsLink1')
        changeStdLink('stdDefsLink2')
      }
      function changeStdLink(name) {
        var d = document.getElementById(name)

        d.setAttribute('href', "std.lsr")
        d.setAttribute('target', "_blank")
      }
      function getStdDefs() {
        document.getElementById('defs').innerHTML += Repl.markupLines(stdDefs) + "<br>"
      }
      function clearOutput() {
        var o = document.getElementById('output')

        o.innerHTML = 'Click on <a id="stdDefsLink2" href="javascript:void(getStdDefs())">Standard Functions</a> to see Leisure\'s standard functions.\n\n'
        //ReplCore.help()
        o.innerHTML += '\n'
      }
      function evalSelection() {
        Repl.evalLine(window.getSelection().toString())
      }
      function evalDoc() {
        var doc = document.getElementById('editor')

        Repl.clearEnv()
        var pgm = Notebook.initNotebook(doc)
        try {
          gen = ReplCore.generateCode('doc', pgm, false)
          Leisure.eval(gen)
        } catch (err) {
          alert(err.stack)
        }
      }
    //]]>
    </script>
    <style type="text/css" media="screen">
      body {
        overflow: hidden;
      }
    
    </style>
    <style>
      .cell {
        vertical-align: top;
        outline: solid black 2px;
      }
      .codeExpr {
        font-style: italic;
        font-weight: bold;
        margin: 3px;
      }
      .codeMain {
        vertical-align: top;
        margin: 3px;
        display: inline-block;
        border-width: 29px 24px 30px 34px;
        -moz-border-image: url(Stock_Photo___Blackboard_by_shigeoARAI.jpg) 29 24 30 34 stretch;
        -webkit-border-image: url(Stock_Photo___Blackboard_by_shigeoARAI.jpg) 29 24 30 34 stretch;
        -o-border-image: url(Stock_Photo___Blackboard_by_shigeoARAI.jpg) 29 24 30 34 stretch;
        border-image: url(Stock_Photo___Blackboard_by_shigeoARAI.jpg) 29 24 30 34 stretch;
      }
      .output {
        border: red solid 2px;
        margin: 3px;
        left-margin: 10px;
        display: inline-block;
        padding: 5px;
      }
      .output span {
        vertical-align: top;
      }
      .codeMainExpr {
        vertical-align: top;
        border-width: 29px 30px 37px 34px;
        -moz-border-image: url(whiteboardTestWithShadow.png) 29 30 37 34 stretch;
        -webkit-border-image: url(whiteboardTestWithShadow.png) 29 30 37 34 stretch;
        -o-border-image: url(whiteboardTestWithShadow.png) 29 30 37 34 stretch;
        border-image: url(whiteboardTestWithShadow.png) 29 30 37 34 stretch;
        margin: 3px;
        display: inline-block;
      }
      .codeName {
        color: blue;
        font-weight: bold;
        margin: 3px;
      }
      .codeBody {
        font-style: italic;
        font-weight: bold;
        margin: 3px;
      }
      .noselect, output, output * {
        -moz-user-select: none;  
        -webkit-user-select: none;  
        -ms-user-select: none;  
      }
    </style>
  </head>
  <body onload="init()" style="border: 0; padding: 0; margin: 0">
    <table style="position: absolute; vertical-align: top; width: 100%; height: 100%">
      <tr style="height: 0">
	<td>
	  <div style="height: 100%; position: relative">
	    <div style="pointer-events:none; text-align: center; position: absolute; width: 100%; top: 0"><b><i>Welcome to Leisure</i></b></div>
	    <div style="float: left"><button onclick="evalDoc()">Process Document</button></div>
	    <div style="float: right"><a href="README.html" target="_blank">Main</a> <a href="REFERENCE.html" target="_blank">Reference</a> <a href="javascript:(void)0">REPL</a> <a id="stdDefsLink1" href="javascript:void(getStdDefs())">Standard Functions</a></div>
	  </div>
	</td>
      </tr>
      <tr style="height: 100%">
	<td class="cell" style="width: 50%">
	  <div style="position: relative; width: 100%; height: 100%; overflow: auto">
	    <pre style="position: absolute; width: 100%; min-height: 100%; margin: 0; padding: 0" id="editor" class="cell" contentEditable="true">

foo = hash-from-list [ 'foo', 5, 'hello', 'world', 'j', 23 ]

bar = hash-from-list [ 'bar', 6, 'hello', 'sun', 'fruit', 'apple' ]

merge-hash foo bar



###############################
# lets visualize our hash-maps!
###############################


circle nil

rect nil

text 'foopy' default-circle-map

decorate-arrow = hash-from-list [ 'x1', 50, 'y1', 25, 'x2', 150, 'y2', 25, 'stroke', 'black', 'stroke-width', 3 ]
decorate-key = hash-from-list [ 'x', 0, 'y', 0, 'rx', 5, 'ry', 5, 'width', 100, 'height', 50, 'fill', 'green', 'stroke', 'black', 'stroke-width', 3 ]
decorate-value = hash-from-list [ 'x', 150, 'y', 0, 'rx', 5, 'ry', 5, 'width', 100, 'height', 50, 'fill', 'yellow', 'stroke', 'black', 'stroke-width', 3 ]
decorate-ktext = hash-from-list [ 'x', 10, 'y', 25 ]
decorate-vtext = hash-from-list [ 'x', 160, 'y', 25 ]
svg-map = hash-from-list [ 'width', 300, 'height', 200 ]


paint-arrow = concat [ (line decorate-arrow), (line (add-hash 'x1' 135 (add-hash 'y1' 15 decorate-arrow))), (line (add-hash 'x1' 135 (add-hash 'y1' 35 decorate-arrow))) ]
paint-node key value offset = translate ( concat [ (paint-arrow), (rect decorate-key), (rect decorate-value), (text key decorate-ktext), (text value decorate-vtext) ] ) 0 offset

derp hm = concat (map (\cell. (paint-node (key cell) (value cell) (height-offset (key cell) hm)   ) ) hm )

height-offset k hm = + 5 (* (indexof (get-keys hm) k) 75)

paint-hash hm = svg ( derp hm ) (add-hash 'height' (* 75 (num-keys hm)) svg-map)

derp foo

(add-hash 'height' (* 75 (num-keys foo)) svg-map)

add-hash 'height' (* 75 (num-keys svg-map)) svg-map

temp = concat (head (map (\cell. [ (paint-node (key cell) (value cell) 0) ]) foo))

translate "foopy" 10 50 

svg (paint-node 'hello' 5 100) svg-map

derp foo

height-offset 'j' foo

paint-hash foo

paint-hash bar

paint-hash (merge-hash foo bar)




            </pre>
	  </div>
	</td>
<!--
	<td class="cell" style="width: 50%">
	  <div style="width: 100%; height: 100%; position: relative; overflow: auto">
	    <pre id="output" style="position: absolute; width: 100%; margin: 0"></pre>
	  </div>
	</td>
-->
      </tr>
<!--
      <tr style="height: 0"><td colspan="2" class="cell">
	  <table style="width: 100%; white-space: nowrap"><tr><td style="width: 100%"><input id="input" type="text" style="width: 100%; margin: 0"></td><td style="width: 0"><div>Load file: <input type="file" onchange="Repl.handleFiles(this)"></input><button onclick="Repl.clearEnv()">Clear</button></td></tr></table>
      </td></tr>
-->
    </table>
  </body>
</html>
